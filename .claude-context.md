# File Share - Project Context

## Overview
A local network file sharing application built with Node.js/Express backend and vanilla HTML/CSS/JS frontend. Serves files from a configurable shared directory with password protection and first-run browser-based setup.

## Tech Stack
- **Backend**: Node.js, Express, Multer (file uploads)
- **Frontend**: Vanilla HTML/CSS/JS (single-page app in `public/index.html`)
- **Auth**: Password hashed with SHA-256 + random salt, HMAC-based tokens with optional expiry
- **Config**: `data/config.json` (auto-generated on first run or via env vars)

## Key Files
- `server.js` - Express server, all API endpoints, config system
- `public/index.html` - Complete SPA with embedded CSS and JS
- `data/config.json` - Persisted configuration (gitignored)
- `docker-compose.yml` - Docker Compose with optional Caddy HTTPS profile
- `Caddyfile.standalone` - Caddy config for standalone HTTPS deployment

## Configuration
- **First run**: Browser shows setup screen to pick password, shared dir, and filesystem toggle
- **Normal use**: Login screen, then file browser
- **Docker/headless**: Set `PASSWORD`, `SHARED_DIR`, `ALLOW_FULL_FILESYSTEM` env vars
- **Priority**: ENV vars > `data/config.json` > defaults (port 4040, ~/shared, no full fs)

## Features

### Core
- File browsing with grid and details/table view (toggle)
- Multi-select with Shift/Ctrl click and rubber band selection
- Upload files (drag & drop or click)
- Create, rename, delete files/folders
- Download files (single, batch, folders as ZIP)
- Copy/Cut/Paste (Ctrl+C/X/V) with clipboard system
- Move files by dragging onto folders (multi-drag, Ctrl+drag=copy)
- Search and sort (by name, date, size)
- Inline rename (F2), batch rename with patterns ({name}, {ext}, #)

### Navigation
- Back/Forward/Up buttons with keyboard shortcuts (Alt+Left/Right/Up)
- Editable address bar (click breadcrumb to type path)
- Sidebar with favorites, drives, and folder tree
- Per-folder memory (view mode, sort, column widths saved per path)
- Browser back/forward button navigation (History API)

### UI
- Preview pane (toggle-able right panel for inline file preview)
- Properties panel (file/folder metadata, recursive folder size)
- Status bar (item count, selection size, disk space)
- Dark/light theme toggle
- Responsive design with mobile enterprise app bar
- Column resize in details view (persisted)
- Undo/Redo (Ctrl+Z/Y) for rename, move, copy, create actions

### Security & Config
- Password protection with SHA-256 + random salt
- HMAC-based auth tokens with configurable expiry
- Rate limiting (5 attempts/minute/IP)
- First-run browser-based setup wizard
- Settings panel post-setup
- Docker with optional Caddy HTTPS

### API Endpoints
- `GET /api/status` - Check if setup is needed
- `POST /api/setup` - First-run configuration
- `POST /api/auth` - Authenticate with password
- `GET /api/settings` / `POST /api/settings` - Get/update settings
- `GET /api/info` - System info (hostname, IP, disk usage)
- `GET /api/list` - List directory (returns name, size, modified, created, permissions, isDirectory)
- `GET /api/drives` - List mounted drives/volumes
- `GET /api/tree` - Folder tree for sidebar
- `POST /api/upload` - Upload files
- `POST /api/mkdir` - Create folder
- `POST /api/touch` - Create empty file
- `POST /api/rename` - Rename file/folder
- `POST /api/move` - Move file/folder
- `POST /api/copy` - Copy file/folder
- `DELETE /api/delete` - Delete file/folder
- `GET /api/download` - Download file (folders streamed as ZIP)
- `GET /api/properties` - File/folder metadata (recursive folder size)
- `GET /files/*` - Serve files for previews

## Running
```bash
node server.js
# Access at http://localhost:4040
# First run shows setup screen in browser
```

## Docker
```bash
# Build and run directly
docker build -t file-share .
docker run -p 4040:4040 -v ./data:/app/data -e PASSWORD=yourpass file-share

# Docker Compose (app only)
docker compose up -d

# Docker Compose with Caddy HTTPS
docker compose --profile https up -d
```

## Session Log

### 2026-01-26
- Built complete file sharing application
- Added multi-select, search/sort, password protection
- Added media gallery, drag-to-move, theme toggle, loading skeletons

### 2026-01-27
- Added browser back/forward button support using History API
- Stripped hardcoded personal data (password, paths, port)
- Added first-run setup screen with browser-based onboarding
- Config persists in `data/config.json` with ENV var overrides
- Password stored as SHA-256 hash with random per-install salt

### 2026-01-27 (session 2)
- Added settings panel (gear button in header) with modal UI
  - Change shared directory, filesystem toggle, and password post-setup
  - Requires current password to save any changes
  - Auto-refreshes auth token, sidebar, and file listing on save
- Added `GET /api/settings` and `POST /api/settings` endpoints
- Fixed settings error text showing "Error" on open (was using `.auth-error` class outside `.auth-box`)
- Reordered settings password fields: current password first, then new + confirm
- Added confirm password field to onboarding setup wizard with mismatch validation

### 2026-01-27 (session 3)
- Added rate limiting on `/api/auth` and `/api/setup` (5 attempts/minute/IP, in-memory)
- Replaced static auth token with HMAC-SHA256 time-stamped tokens
- Added configurable session expiry (never/1d/7d/30d) to setup wizard and settings panel
- Added inline SVG favicon (blue folder icon)
- Added `docker-compose.yml` with optional Caddy HTTPS profile
- Added `Caddyfile.standalone` for standalone HTTPS deployment
- Docker end-to-end tested: build, setup flow, auth, rate limiting, settings

### 2026-01-28
- Redesigned mobile header as enterprise app bar with overflow menu
  - Replaced cluttered multi-row button wrap with single-row toolbar: `[☰] File Explorer [Upload] [⋮]`
  - Added vertical dots overflow menu with all secondary actions (Upload Files, New Folder, System Info, Settings, Toggle Theme, Log Out)
  - Moved sidebar-open-btn into header as inline hamburger icon (was a floating blue button)
  - Added outside-click-to-close for overflow dropdown
  - Added `sidebar-is-collapsed` body class for CSS targeting (needed after moving button out of `.main-content`)
  - Desktop layout unchanged — all buttons visible inline, hamburger/overflow hidden
  - Follows Google Drive / Dropbox / OneDrive enterprise mobile pattern

### 2026-02-10
- Added hidden files toggle button to toolbar
- Created full GitHub README with hero screenshot, features, quick start, Docker guide, screenshot gallery, security model, API reference, and tech stack
- Added MIT LICENSE file
- Updated `/file-share` slash command (removed hardcoded password, corrected architecture)
- Created GitHub repo: https://github.com/brobata/file-share (public)
- Pushed all commits to GitHub

### 2026-02-24
- Implemented 20 Windows Explorer features across 7 batches (all committed + pushed)
- **Batch 1**: Back/Forward/Up nav buttons, editable address bar, status bar
- **Batch 2**: Details/table view, dynamic context menus, new file creation (`POST /api/touch`)
- **Batch 3**: Copy/Cut/Paste clipboard, arrow key navigation, inline rename (F2)
- **Batch 4**: Multi-drag, Ctrl+drag=copy, properties panel, folder ZIP download (`archiver`)
- **Batch 5**: Favorites sidebar (localStorage), batch rename with patterns, preview pane
- **Batch 6**: Rubber band selection (click-drag rectangle), column resize in details view
- **Batch 7**: Undo/Redo (Ctrl+Z/Y, max 50 actions), per-folder view/sort/column memory (LRU 100)
- Server endpoints added: `/api/touch`, `/api/copy`, `/api/properties`, `/api/download` (ZIP for folders)
- `public/index.html`: 3960 → 5825 lines | `server.js`: 722 → 831 lines
- Added `archiver` dependency for folder ZIP downloads
